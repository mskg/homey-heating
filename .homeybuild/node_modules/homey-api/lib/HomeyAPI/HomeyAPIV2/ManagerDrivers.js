'use strict';

const ManagerDriversV3 = require('../HomeyAPIV3/ManagerDrivers');
const Driver = require('./ManagerDrivers/Driver');
const PairSession = require('./ManagerDrivers/PairSession');

class ManagerDrivers extends ManagerDriversV3 {

  static CRUD = {
    ...super.CRUD,
    Driver,
    PairSession,
  }

  async getDriver({
    $cache = true,
    id,
  }) {
    if ($cache === true && this.__cache['driver'][id]) {
      return this.__cache['driver'][id];
    }

    return this.__super__getDriver({
      id: id.split(':').reverse()[0],
      uri: id.split(':', 3).join(':'),
    });
  }

  async createPairSession({
    pairsession,
    ...props
  }) {
    if (pairsession.driverId) {
      pairsession.driverUri = pairsession.driverId.split(':', 3).join(':');
      pairsession.driverId = pairsession.driverId.split(':').reverse()[0];
    }

    return this.__super__createPairSession({
      pairsession,
      ...props,
    });
  }

}

module.exports = ManagerDrivers;
